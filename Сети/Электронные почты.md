Чтобы иметь возможность работать с электронной почтой, вам нужен почтовый клиент. Это может быть как веб-клиент, допустим gmail, owa, roundcube, так и приложение на компьютере — outlook, thunderbird и т.п. Предположим, вы уже зарегистрировались на каком-то почтовом сервисе и вам нужно настроить почтовый клиент. Вы открываете программу и она запрашивает у вас данные: имя для аккаунта, ваш почтовый адрес и пароль.  
  
![image](https://habrastorage.org/r/w1560/webt/gd/wm/wa/gdwmwaptbjjvfyjlmtyiiv_mevc.png)  
  
После того, как вы введёте эти данные, ваш почтовый клиент попытается найти информацию о вашем почтовом сервере. Это делается для упрощения настройки подключения к серверу, так как большинство пользователей не знают адресов и протоколов подключения. Для этого почтовые клиенты используют разные способы поиска информации о сервере и настройках подключения. Эти способы могут различаться в зависимости от почтового клиента.  
  
![image](https://habrastorage.org/r/w1560/webt/wb/y8/oj/wby8ojpp1cg5_el9jrs4hvvqg5u.png)  
  
Для примера, Outlook использует метод «autodiscover», клиент обращается к dns серверу и спрашивает об определённой записи autodiscover, которая связана с тем почтовым доменом, который вы указали в настройках вашего почтового клиента. Если администратор настроил данную запись на DNS сервере, она указывает на вебсервер.  
  
![image](https://habrastorage.org/r/w1560/webt/ti/5u/fp/ti5ufpfwlmxducyjy7t5giaqvu8.png)  
  
После того, как почтовый клиент узнал адрес вебсервера, он обращается к нему и находит там заранее подготовленный файл с настройками подключения к почтовому серверу в формате XML.  
  
![image](https://habrastorage.org/r/w1560/webt/im/jy/kj/imjykj-4cnqzqmwa5ct6p8onn6c.png)  
  
В случае с Thunderbird, почтовый клиент обходится без поиска DNS записи autodiscover, а сразу пытается подключиться к вебсерверу autoconfig. и имя указанного домена. И также пытается на вебсервере найти файл с настройками подключения в XML формате.  
  
![image](https://habrastorage.org/r/w1560/webt/ig/uf/mz/igufmzx7ogem9gpc4utk6aaeut4.png)  
  
Если почтовый клиент не находит файла с необходимыми настройками, он попытается угадать настройки среди часто используемых. Например, если домен называется example.com, то почтовый сервер проверит, есть ли сервера с названиями imap.example.com и smtp.example.com. Если найдёт — пропишет это в настройках. Если же почтовый клиент никак не может определить адрес почтового сервера, он предложит пользователю самому ввести данные подключения.  
  
![image](https://habrastorage.org/r/w1560/webt/u6/t3/wo/u6t3wolilnuwmn6v7dp72aykxr4.png)  
  
Тогда вы заметите 2 поля для серверов — адрес сервера входящей почты и адрес сервера исходящей почты. Как правило, в небольших организациях эти адреса совпадают, пусть даже указаны через разные DNS имена, а в больших компаниях это могут быть разные сервера. Но не важно, это один и тот же сервер или нет — сервисы, стоящие за ними, разные. Одна из самых популярных связок почтовых сервисов — Postfix & Dovecot. Где Postfix выступает в роли сервера исходящей почты (MTA — mail transfer agent), а Dovecot в роли сервера входяшей почты (MDA — mail delivery agent). По названию можно догадаться, что Postfix используется для отправки почты, а Dovecot — для получения почты почтовым клиентом. Сами почтовые сервера же общаются между собой по протоколу SMTP — т.е. Dovecot (MDA) нужен для пользователей.  
  
![image](https://habrastorage.org/r/w1560/webt/rg/pq/dw/rgpqdwa6p3xqgkawkbi5_2bss-a.png)  
  
Допустим, мы настроили подключение к нашему почтовому серверу. Давайте попробуем отправить сообщение. В сообщении мы указываем свой адрес и адрес получателя. Теперь, чтобы доставить сообщение, ваш почтовый клиент отправит сообщение на ваш сервер исходящей почты.  
  
![image](https://habrastorage.org/r/w1560/webt/xo/8y/c9/xo8yc9hqesmmen_imelwid8fhbo.png)  
  
Когда ваш сервер получит сообщение, он попытается найти, кому же доставить это сообщение. Ваш сервер не может знать наизусть адреса всех почтовых серверов, поэтому он обращается к DNS с целью найти специальную запись MX — указывающую на почтовый сервер для данного домена. Эти записи могут отличаться для разных сабдоменов.  
  
![image](https://habrastorage.org/r/w1560/webt/ac/bl/t9/acblt9ocaounyp2tbp630kurvi0.png)  
  
После того, как он узнает адрес сервера получателя, он отправляет ваше сообщение по SMTP на этот адрес, где почтовый сервер (MTA) получателя примет сообщение и положит в специальную директорию, в которую также смотрит сервис, отвечающий за получение клиентами сообщений (MDA).  
  
![image](https://habrastorage.org/r/w1560/webt/qg/w0/2m/qgw02m9vwo250tvslakgxyzkblq.png)  
  
Когда в следующий раз почтовый клиент получателя спросит у сервера входящей почты о наличии новых сообщений, MDA отправит ему ваше сообщение.