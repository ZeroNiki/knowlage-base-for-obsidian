Конечно, давай разберём работу Nginx как прокси на примере твоего проекта без лишних украшений.

---

## 1. Основная идея Nginx Proxy

Nginx выступает в роли **обратного прокси (reverse proxy)**.
Он:

1. Получает HTTP-запрос от клиента.
2. Определяет, какому внутреннему сервису передать запрос.
3. Возвращает клиенту ответ от этого сервиса.

Зачем это нужно в твоём проекте:

* Все микросервисы (gateway, session, booking и др.) доступны только внутри Swarm-сети `internal_net`.
* Внешний мир не знает их имена и порты.
* Nginx получает запросы на известные порты и перенаправляет их на нужный контейнер.

---

## 2. Пример из проекта

### nginx.conf

```nginx
events { }

http {
    server {
        listen 8087;

        location / {
            proxy_set_header Host gateway-service;
            proxy_pass http://gateway-service:8087;
        }
    }

    server {
        listen 8081;

        location / {
            proxy_set_header Host session-service;
            proxy_pass http://session-service:8081;
        }
    }
}
```

Что здесь происходит:

* **Сервер на порту 8087** принимает запросы и проксирует их на контейнер `gateway-service:8087`.
* **Сервер на порту 8081** принимает запросы и проксирует их на контейнер `session-service:8081`.
* `proxy_set_header Host ...` подставляет правильный заголовок Host, чтобы сервисы могли корректно обрабатывать запросы.

---

## 3. Как это работает с Docker Swarm

В docker-compose.yml:

```yaml
nginx-proxy:
  image: nginx:alpine
  ports:
    - "8081:8081"
    - "8087:8087"
  configs:
    - source: nginx_conf
      target: /etc/nginx/nginx.conf
  depends_on:
    - gateway-service
    - session-service
  networks:
    - internal_net
```

* `ports` — внешние порты на хосте.
* `networks` — Nginx подключён к `internal_net`, где есть все сервисы.
* Имена контейнеров работают как DNS внутри сети Swarm, поэтому `gateway-service:8087` доступен для Nginx.

---

## 4. Последовательность запроса

Например, клиент делает запрос:

```
GET http://<manager-node>:8087/api/hotels
```

1. Nginx слушает порт 8087.
2. По конфигурации Nginx маршрутизирует запрос на `gateway-service:8087`.
3. Получает ответ от контейнера.
4. Отправляет ответ клиенту.

---

## 5. Схема

```
[Клиент] --> 8087 --> [Nginx] --> gateway-service:8087
[Клиент] --> 8081 --> [Nginx] --> session-service:8081
```

---

## 6. Важные моменты

* Микросервисы **не открыты напрямую** внешнему миру, только через Nginx.
* Nginx можно настроить на **upstream и балансировку нагрузки**, если один сервис масштабируется на несколько контейнеров.
* Внешние клиенты всегда используют Nginx, внутренние изменения сервисов не влияют на доступность.

---

Если хочешь, я могу нарисовать **визуальную схему сети твоего проекта с Nginx и микросервисами**, чтобы сразу видеть поток запросов и распределение портов.

Хочешь, чтобы я это сделал?