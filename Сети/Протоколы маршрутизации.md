## Маршрутизация сетей — что это

Компьютерную сеть составляют устройства (узлы) и маршруты (связи между ними). Маршрутизация означает определение оптимального маршрута при доставке пакета информации. При этом заранее устанавливают и обязательно применяют определенные правила. На I этапе маршрутизации изучается сеть и ее подсети, а также схема расположения маршрутизаторов (транзитных узлов). На II этапе определяется дальнейшее направление движения поступившего пакета.

### Почему маршрутизация важна

Когда в сети происходят сбои, пользователи очень долго ожидают загрузку web-страниц. Также могут возникнуть неполадки в работе серверов из-за невозможности обслужить большое количество посетителей сайтов. Маршрутизация обеспечивает эффективное управление трафиком, позволяющее сети оптимально функционировать и предоставлять пользователям максимум пропускной способности.

## Как действует маршрутизация

Маршрутизация функционирует на сетевом уровне модели [OSI](https://itspectr.ru/definitions/7-urovnej-setevoj-modeli-osi/). Любая информация транспортируется по сети в виде пакетов данных, каждый из которых снабжен заголовком, где имеются сведения о возможном адресате. Когда маршрутизатор получает пакет, он просматривает таблицу маршрутизации, находит свой адрес и пересылает информацию дальше, на следующий транзитный узел. В течение всего процесса доставки маршрутизаторы перенаправляют пакеты данных много раз. В таблицу маршрутизации конкретного [роутера](https://itspectr.ru/chto-takoe-marshrutizator-prostym-slovami-chem-otlichaetsya-ot-routera/) либо сервера входит только адрес следующего транзитного узла. Так постепенно информация «добирается» до адресата.

### Маршрутизатор — что это

Маршрутизацию осуществляют специальные транзитные узлы, выполняющие следующие функции:

- Поиск оптимального пути перемещения данных на основе анализа сетевых параметров (пропускная способность, задержка, скорость).
- Пересылка информации на следующий узел по определенному маршруту.
- Управление нагрузкой. Маршрутизатор отправляет копии пакета по различным путям для минимизации ошибок, создания избыточности и управления трафиком.

Маршрутизаторы передают информацию внутри сетей и между ними.

## Какие виды маршрутизации существуют

Маршрутизация подразделяется на 2 вида в зависимости от принципа создания таблиц: статическую и динамическую.

||Статическая|Динамическая|
|---|---|---|
|Таблицы маршрутизации…|…необходимы для введения ручных настроек и выбора путей направления пакетов в условиях неизменности сетевой структуры либо параметров|…создаются и обновляются в процессе исполнения задачи на основе действующих условий сети|
|Особенность заключается в…|…настройке резервных маршрутов для минимизации последствий сбоев канала|…поиске самого скоростного маршрута посредством протокола динамической маршрутизации|
|Недостатки проявляются в…|…перегрузке сетей, снижении их адаптивности и гибкости, что в конечном счете снижает сетевую производительность|…сложности настройки и необходимости привлечения ИТ-специалистов|
|Преимущества заключаются в…|…простоте настройке и заметны, когда сеть маленькая и изменяется нечасто|…быстрой адаптации к изменяющимся сетевым параметрам (количество трафика, пропускная способность, сбои) и автоматическом добавлении либо удалении конкретного маршрута|


## Протоколы маршрутизации

Протоколами маршрутизации называют особые условия, устанавливающие принципы идентификации и пересылки пакетов по сети. Существуют протоколы внутренних (применяют в отдельной сети, чаще всего в одной организации) и внешних шлюзов (передают данные между отдельными сетями). Первые анализируют автономную сеть и принимают решения, вычисляя:

- сколько переходов либо транзитных узлов имеется между источником и получателем;
- какое количество времени необходимо для пересылки информации в пункт назначения, и имеются ли какие-либо задержки;
- пропускную способность канала.

Одним из примеров такого протокола является OSPF, который анализирует сведения, поступившие от других транзитных узлов, и находит кратчайший маршрут до адресата.

Протокол внешнего (пограничного) шлюза BGP служит для маршрутизации между независимыми системами, составляющими Интернет. Каждая из них обладает особенным номером ASN, отслеживаемым протоколом BGP в целях определения оптимального пути следования информации.

Все протоколы маршрутизации применяют в работе специальные алгоритмы — программы, которые присваивают каналам номера стоимости, рассчитываемые на основе сетевых параметров. Маршрутизаторы анализируют затраты на пересылку пакетов и выбирают каналы с наилучшими показателями, чтобы задействовать  минимум ресурсов. Например, алгоритм маршрутизации вектора расстояния подразумевает, что все транзитные узлы передают другу другу различные обновления об общей стоимости применяемых маршрутов, чтобы у всех роутеров были актуальные сведения. Алгоритм маршрутизации состояния канала позволяет каждому транзитному узлу создать карту сети для вычисления кратчайшего пути.

## Что такое облачная маршрутизация

Облачная маршрутизация выполняет те же задачи, но передает пакеты между сетями, расположенными в облаке, либо между облачной и локальной. Для этих целей применяют протокол BGP. При передаче данных происходит автоматическая адаптация процесса пересылки информации к изменяющимся параметрам облачной сети. Роль облачного маршрутизатора выполняет особый софт, выступающий как виртуальный транзитный узел.

## Таблица маршрутизации

Обычно маршрутизаторы автоматически создают таблицы, но в некоторых случаях необходима ручная настройка (на профессиональном либо старом оборудовании). Таблицы нужны, чтобы транзитный узел знал, в каком направлении отправить пакет данных. Если сеть крупная, то она состоит из множества маршрутизаторов, серверов, компьютеров и мобильных устройств. Таблица составляется для облегчения поиска конечного абонента, т. к. большое количество переходов может задержать доставку информации. Если все составлено верно, то каждый транзитный узел четко понимает, куда дальше направлять пакет данных.

### Разновидности таблиц

Таблицы подразделяются на статические и динамические. Информация, внесенная в статические таблицы, автоматически не изменяется, а корректируется вручную. Если абонент изменил свой адрес в сети, и изменения в таблицу вовремя не были внесены, то все предназначенные ему пакеты данных будут доставляться по прежнему маршруту, но их никто не получит. Также в таблицу необходимо вносить данные о подключении нового оборудования, иначе сеть не «увидит» этого абонента. Статическая таблица не зависит от перезагрузки маршрутизатора и переустановки его в другое место.

Динамические таблицы составляет сам роутер или сервер. Устройство, подключенное к сети по протоколу TCP, сразу же уведомляет ближайший маршрутизатор о своем имени и адресе, т. е. о готовности обмениваться информацией. Транзитный узел после получения этого сообщения сразу добавляет нового абонента в свою сеть. Так же роутеры с серверами при первоначальном подключении уведомляют все устройства о своем адресе и параметрах и, соответственно, запрашивают аналогичные данные с их стороны. Это позволяет проанализировать имеющиеся таблицы маршрутизации и просмотреть доступные направления. Транзитные узлы производят обмен информацией достаточно часто.

Динамические таблицы периодически очищаются от ставших бесполезными записей. При отсоединении устройства от сети оно по прошествии определенного времени удаляется из таблиц. Маршрутизатор после отключения от сети заново создаст динамическую таблицу, а статическую прогрузит без изменений.

### Информация в таблице

|Адрес|Маска|Шлюз|Интерфейс|Метрика|
|---|---|---|---|---|
|192.168.0.0|255.255.255.0|Подсоединен|192.168.2.2|276|
|10.1.1.0|255.255.0|10.1.0.61|10.1.0.15|306|

В таблице маршрутизации Windows имеются следующие данные:

- Адрес и [маска](https://itspectr.ru/definitions/maska-seti-chto-eto-kak-s-ee-pomoshhyu-opredelit-ip-adres-uzla/) — для определения адреса подсети.
- Шлюз — показывает направление пакета данных. Подключенные сети, куда необходимо передать информацию напрямую, определены как «подсоединен». Если указан [IP-адре](https://itspectr.ru/chto-takoe-ip-adres-kak-uznat-svoj-ip/)с, то пакет нужно направить на следующий транзитный узел по этому адресу.
- Интерфейс маршрутизатора, где идентификатором служит IP-адрес.
- Метрика — показывает расстояние до следующей сети. Если к одной сети идет несколько маршрутов, то автоматически выбирается путь с наименьшей метрикой. Параметр учитывает количество промежуточных транзитных узлов, скорость и загрузку каналов.

Таблица [Linux](https://itspectr.ru/definitions/linux-chto-eto-vidy-os-linux/) выглядит почти так же, только вместо IP-адресов в качестве идентификатора применяют название интерфейсов: беспроводной сетевой обозначается как wlan, проводной — eth. Все таблицы маршрутизации могут иметь и дополнительные столбцы, но основные вышеприведенные параметры должны присутствовать всегда.

### Путь по умолчанию

Бывают ситуации, когда транзитный узел не понимает, куда направить информацию. Для этого в таблицу вносится особый маршрутизатор (имеющий выход в интернет), куда по умолчанию пересылаются все пакеты с неизвестным путем следования. Этот транзитный узел самостоятельно изучает сеть и ищет дальнейший маршрут. В таблице он обозначается нулями в столбцах адреса и маски или как default.
