# **Arenas (–ê—Ä–µ–Ω—ã) –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø–∞–º—è—Ç—å—é**  

## üìå **–ß—Ç–æ —Ç–∞–∫–æ–µ –∞—Ä–µ–Ω—ã (Arenas)?**  
**–ê—Ä–µ–Ω—ã (memory arenas)** ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –≤—ã–¥–µ–ª—è–µ—Ç—Å—è **–±–æ–ª—å—à–æ–π –±–ª–æ–∫ –ø–∞–º—è—Ç–∏ —Å—Ä–∞–∑—É**, –∞ –∑–∞—Ç–µ–º –æ–Ω —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **–º–µ–ª–∫–∏–µ –∫—É—Å–∫–∏** –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.  

üîπ **–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è**:  
–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å —á–∞—Å—Ç—ã–µ –≤—ã–∑–æ–≤—ã `malloc()`/`free()`, –∞—Ä–µ–Ω–∞ –≤—ã–¥–µ–ª—è–µ—Ç **–±–æ–ª—å—à–æ–π —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏** –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏–º –ª–æ–∫–∞–ª—å–Ω–æ.  

üîπ **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?**  
- **–ê–ª–ª–æ–∫–∞—Ç–æ—Ä—ã –ø–∞–º—è—Ç–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `glibc`, `jemalloc`, `tcmalloc`)  
- **–ò–≥—Ä–æ–≤—ã–µ –¥–≤–∏–∂–∫–∏** (–±—ã—Å—Ç—Ä–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é)  
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã)  

---

## üìå **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∞—Ä–µ–Ω—ã?**  

üîπ **1. –í—ã–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –±–ª–æ–∫–∞ –ø–∞–º—è—Ç–∏**  
```c
void *arena = malloc(1024 * 1024);  // 1 MB
```

üîπ **2. –†–∞–∑–¥–∞—á–∞ –ø–∞–º—è—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∞—Ä–µ–Ω—ã**  
```c
void *ptr1 = arena + 0;      // –ü–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç
void *ptr2 = arena + 128;    // –í—Ç–æ—Ä–æ–π –æ–±—ä–µ–∫—Ç
```

üîπ **3. –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π**  
```c
free(arena);  // –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –≤—Å—é –∞—Ä–µ–Ω—É —Å—Ä–∞–∑—É
```

---

## üìå **–ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã –∞—Ä–µ–Ω**  

### ‚úÖ **–ü–ª—é—Å—ã:**  
‚úî –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–±–µ–∑ `malloc/free`)  
‚úî –ù–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏  
‚úî –û–¥–Ω–æ `free()` –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É  

### ‚ùå **–ú–∏–Ω—É—Å—ã:**  
‚úò –ü–∞–º—è—Ç—å –Ω–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ (—Ç–æ–ª—å–∫–æ –≤—Å—é –∞—Ä–µ–Ω—É)  
‚úò –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º  

---

## üìå **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–∞ –∞—Ä–µ–Ω –≤ C**  

```c
#include <stdio.h>
#include <stdlib.h>

typedef struct {
    char *memory;
    size_t offset;
    size_t size;
} Arena;

// –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä–µ–Ω—ã
Arena *arena_create(size_t size) {
    Arena *arena = malloc(sizeof(Arena));
    arena->memory = malloc(size);
    arena->offset = 0;
    arena->size = size;
    return arena;
}

// –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∞—Ä–µ–Ω—ã
void *arena_alloc(Arena *arena, size_t size) {
    if (arena->offset + size > arena->size) return NULL;  // –ù–µ—Ç –º–µ—Å—Ç–∞
    void *ptr = arena->memory + arena->offset;
    arena->offset += size;
    return ptr;
}

// –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ–π –∞—Ä–µ–Ω—ã
void arena_free(Arena *arena) {
    free(arena->memory);
    free(arena);
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
int main() {
    Arena *arena = arena_create(1024);  // 1 KB

    int *arr = arena_alloc(arena, 10 * sizeof(int));
    arr[0] = 42;
    printf("arr[0] = %d\n", arr[0]);

    arena_free(arena);  // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –≤—Å—ë —Ä–∞–∑–æ–º
    return 0;
}
```

---

## üìå **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ä–µ–Ω –≤ `glibc`**  

–í `glibc` **–∞—Ä–µ–Ω—ã** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `malloc()`, —á—Ç–æ–±—ã **—Ä–∞–∑–¥–µ–ª—è—Ç—å –ø–∞–º—è—Ç—å –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏**.  
```sh
MALLOC_ARENA_MAX=4 ./program
```
üîπ –ü–æ–∑–≤–æ–ª—è–µ—Ç **—É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—é –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏**, –≤—ã–¥–µ–ª—è—è **–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∞—Ä–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞**.

---

## üéØ **–í—ã–≤–æ–¥**  
‚úÖ **–ê—Ä–µ–Ω—ã ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é, —É—Å–∫–æ—Ä—è—é—â–∏–π –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏.**  
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **–∏–≥—Ä–∞—Ö, —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏, –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–∞—Ö –ø–∞–º—è—Ç–∏**.  
‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç **—É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã malloc/free**. 
‚úÖ –í `glibc` –ø–æ–º–æ–≥–∞–µ—Ç **–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º**.  