**Stack** (стек) в **Docker** — это:
- группа взаимосвязанных сервисов, которые вместе составляют приложение;
- упакованы в единый docker-compose.yml;
- Swarm управляет ими как одним блоком.

Например:
- есть postgres, rabbitmq, booking-service, gateway-service.
- Вместо того чтобы управлять каждым сервисом отдельно (docker service create, docker service update), ты управляешь ими через стек.

## Как это выглядит
Если выполнить:
```bash
docker stack deploy -c docker-compose.yml mystack
```

То:
- создастся стек `mystack`,
- внутри появятся сервисы:
    - `mystack_postgres`
    - `mystack_rabbitmq`
    - `mystack_booking-service`
    - `mystack_gateway-service` 

Проще всего думать так:
- Stack = docker-compose для Swarm, то есть набор сервисов, который Swarm оркестрирует как единое приложение.

## Отличия от `docker compose`
### `docker-compose up`

* Используется **без Swarm**, просто с Docker Engine.
* Запускает контейнеры **локально на одной машине**.
* Работает с **любым `docker-compose.yml` (v2, v3, v4)**.
* Поддерживает:

  * `build:` (можно собирать образы на месте)
  * `container_name:`
  * `depends_on:` (упрощённое управление порядком запуска)
* Но:

  * нет масштабирования на несколько узлов,
  * нет автоматического восстановления контейнеров при сбое,
  * нет встроенного load balancing.

Пример:

```bash
docker-compose up -d
```

###  `docker stack deploy`

* Используется **только в Swarm mode** (`docker swarm init`).
* Запускает контейнеры как **сервисы в кластере** (могут быть на manager/worker узлах).
* Поддерживает **только `version: "3.x"`**.
* Не поддерживает:

  * `build:` (нужны заранее собранные и загруженные образы, например, в Docker Hub),
  * `container_name:` (имена назначаются автоматически).
* Добавляет:

  * масштабирование сервисов (`docker service scale`),
  * автоматическое восстановление при сбое,
  * балансировку трафика между нодами,
  * секреты и конфиги (встроенные).

Пример:

```bash
docker stack deploy -c docker-compose.yml mystack
```

### Сравнение простыми словами

* **`docker-compose up`** → для локальной разработки, когда у тебя всё на одном ноутбуке.
* **`docker stack deploy`** → для продакшена или кластеров, где нужно распределять нагрузку и управлять десятками сервисов.

### Мини-таблица

| Функция                            | docker-compose | docker stack      |
| ---------------------------------- | -------------- | ----------------- |
| Формат файла                       | v2, v3, v4     | только v3.x       |
| Поддержка `build:`                 | ✅              | ❌ (нужен `image`) |
| Поддержка `container_name:`        | ✅              | ❌                 |
| Масштабирование на несколько узлов | ❌              | ✅                 |
| Балансировка трафика               | ❌              | ✅                 |
| Автовосстановление                 | ограничено     | ✅                 |
| Использование                      | Dev/локально   | Prod/Swarm        |

---

То есть:
- * если ты **разрабатываешь локально** → `docker-compose up`.
- * если у тебя **кластер (manager + workers)** → `docker stack deploy`.